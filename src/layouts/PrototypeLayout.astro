---
import Footer from "@/components/layout/Footer.astro";
import PageLayout from "@/layouts/Base.astro";
import type { SiteMeta } from "@/types";

interface Props {
	meta: SiteMeta;
	title: string;
	demoHeight?: string;
	demoStyle?: "embedded" | "immersive";
}

const { meta, title, demoHeight = "60vh", demoStyle = "embedded" } = Astro.props;
const isImmersive = demoStyle === "immersive";
---

<PageLayout meta={meta}>
	<div class="flex min-h-full flex-col">
		<!-- Header with back link and title -->
		<header class="px-4 py-4 sm:px-8 sm:py-6 sm:pt-3">
			<a
				href="/#forge"
				class="back-link mb-4 inline-flex items-center gap-2 text-sm opacity-70 transition-opacity hover:opacity-100"
			>
				<svg
					xmlns="http://www.w3.org/2000/svg"
					width="16"
					height="16"
					viewBox="0 0 24 24"
					fill="none"
					stroke="currentColor"
					stroke-width="2"
					stroke-linecap="round"
					stroke-linejoin="round"
				>
					<line x1="19" y1="12" x2="5" y2="12"></line>
					<polyline points="12 19 5 12 12 5"></polyline>
				</svg>
				<span>back to forge</span>
			</a>
			<h1 class="mt-3 text-2xl lowercase sm:text-4xl">{title}</h1>
		</header>

		<!-- Demo Area -->
		<div class="demo-wrapper p-6">
			<div
				class:list={[
					"demo-container relative overflow-hidden rounded-2xl",
					{ "demo-immersive": isImmersive },
				]}
				style={`min-height: ${demoHeight};`}
			>
				<div class:list={[{ "fade-edges": isImmersive }]}>
					<slot name="demo" />
				</div>
			</div>
		</div>

		<!-- Content Area -->
		<div class="content-area flex-1 px-4 py-8 sm:px-8 sm:py-12">
			<div class="prose-container max-w-3xl">
				<slot />
			</div>
		</div>

		<Footer />
	</div>
</PageLayout>

<style>
	.back-link {
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		text-decoration: none;
		transition: opacity 0.2s ease;
	}

	.back-link:hover {
		text-decoration: underline;
	}

	.demo-wrapper {
		border-bottom: 1px solid hsl(var(--border-divider) / 0.3);
	}

	.demo-container {
		background: hsl(var(--theme-bg) / 0.5);
		border: 1px solid hsl(var(--border-divider) / 0.3);
	}

	/* Immersive demo style - darker background for visualizations */
	.demo-immersive {
		background: hsl(var(--theme-bg-inverse) / 1);
	}

	/* Fade edges effect for immersive demos */
	.fade-edges {
		width: 100%;
		height: 100%;
		display: flex;
		align-items: center;
		justify-content: center;
		-webkit-mask-image: radial-gradient(circle at center, black 0%, black 50%, transparent 100%);
		mask-image: radial-gradient(circle at center, black 0%, black 25%, transparent 100%);
		-webkit-mask-size: 100% 100%;
		mask-size: 100% 100%;
		-webkit-mask-position: center;
		mask-position: center;
	}

	.prose-container {
		/* Prose styling for content */
	}

	.prose-container :global(h2) {
		font-size: 1.5rem;
		font-weight: 700;
		margin-top: 2rem;
		margin-bottom: 1rem;
	}

	.prose-container :global(h3) {
		font-size: 1.25rem;
		font-weight: 600;
		margin-top: 1.5rem;
		margin-bottom: 0.75rem;
	}

	.prose-container :global(p) {
		margin-bottom: 1rem;
		line-height: 1.75;
	}

	.prose-container :global(ul),
	.prose-container :global(ol) {
		margin-bottom: 1rem;
		padding-left: 1.5rem;
	}

	.prose-container :global(li) {
		margin-bottom: 0.5rem;
	}

	.prose-container :global(code) {
		font-family: "JetBrains Mono Variable", monospace;
		font-size: 0.875em;
		background: hsl(var(--theme-bg-inverse) / 0.1);
		padding: 0.125rem 0.375rem;
		border-radius: 0.25rem;
	}

	.prose-container :global(pre) {
		background: hsl(var(--theme-bg-inverse) / 0.05);
		border: 1px solid hsl(var(--border-divider) / 0.2);
		border-radius: 0.5rem;
		padding: 1rem;
		overflow-x: auto;
		margin-bottom: 1rem;
	}

	.prose-container :global(pre code) {
		background: none;
		padding: 0;
	}

	.prose-container :global(a) {
		color: hsl(var(--theme-link));
		text-decoration: underline;
	}

	.prose-container :global(a:hover) {
		opacity: 0.8;
	}

	.prose-container :global(blockquote) {
		border-left: 3px solid hsl(var(--border-divider) / 0.5);
		padding-left: 1rem;
		margin-left: 0;
		margin-bottom: 1rem;
		font-style: italic;
		opacity: 0.9;
	}

	@media (max-width: 640px) {
		.demo-container {
			min-height: 50vh !important;
		}
	}
</style>
