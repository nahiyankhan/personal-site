---
import { Icon } from "astro-icon/components";
---

<div class="theme-toggle-container">
	<button
		class="theme-toggle"
		type="button"
		x-data
		@click="$store.theme.toggleMode(); $el.classList.remove('flickering'); void $el.offsetWidth; $el.classList.add('flickering'); setTimeout(() => $el.classList.remove('flickering'), 500)"
		aria-label="Toggle theme"
	>
		<span class="toggle-indicator"></span>
		<span class="toggle-inner">
			<Icon
				aria-hidden="true"
				class="toggle-icon toggle-icon-moon"
				focusable="false"
				name="solar:moon-bold-duotone"
			/>
			<Icon
				aria-hidden="true"
				class="toggle-icon toggle-icon-sun"
				focusable="false"
				name="solar:sun-bold-duotone"
			/>
		</span>
	</button>
</div>

<style>
	.theme-toggle-container {
		position: fixed;
		right: 2rem;
		bottom: calc(1rem + 90px);
		z-index: 100;
	}

	@media (min-width: 640px) {
		.theme-toggle-container {
			right: 3rem;
			bottom: calc(2rem + 120px);
		}
	}

	.theme-toggle {
		/* Analogue rocker switch */
		width: 26px;
		height: 52px;
		border-radius: 8px;
		background: hsl(var(--theme-bg-inverse) / 0.95);
		backdrop-filter: blur(8px);
		border: 1px solid hsl(var(--border-divider) / 0.4);
		cursor: pointer;
		transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
		position: relative;
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		gap: 6px;
		padding: 8px 6px;

		/* Inset shadow for depth - like a recessed button */
		box-shadow:
			inset 0 2px 4px rgba(0, 0, 0, 0.15),
			inset 0 -1px 2px rgba(255, 255, 255, 0.05),
			0 1px 3px rgba(0, 0, 0, 0.15);
	}

	@media (min-width: 640px) {
		.theme-toggle {
			width: 38px;
			height: 60px;
			padding: 10px 8px;
			gap: 8px;
		}
	}

	/* Scanline overlay */
	.theme-toggle::after {
		content: "";
		position: absolute;
		inset: 0;
		background: repeating-linear-gradient(
			0deg,
			transparent 0px,
			transparent 2px,
			rgba(0, 0, 0, 0.08) 2px,
			rgba(0, 0, 0, 0.08) 3px
		);
		border-radius: 5px;
		pointer-events: none;
		opacity: 0.6;
	}

	/* LED indicator light at top */
	.toggle-indicator {
		width: 16px;
		height: 5px;
		border-radius: 2px;
		background: hsl(var(--border-divider) / 0.2);
		border: 1px solid hsl(var(--border-divider) / 0.15);
		transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
		position: relative;
		box-shadow: 0 0 2px rgba(0, 0, 0, 0.1);
	}

	@media (min-width: 640px) {
		.toggle-indicator {
			width: 20px;
			height: 6px;
			border-radius: 3px;
		}
	}

	/* Light mode - cool blue/white LED */
	.toggle-indicator {
		background: linear-gradient(
			90deg,
			rgba(100, 180, 255, 0.6) 0%,
			rgba(150, 220, 255, 0.8) 50%,
			rgba(100, 180, 255, 0.6) 100%
		);
		box-shadow:
			-1px 0 0 rgba(100, 150, 255, 0.5),
			1px 0 0 rgba(150, 255, 255, 0.5),
			0 0 8px rgba(100, 200, 255, 0.4),
			0 0 12px rgba(100, 200, 255, 0.2);
	}

	/* Dark mode - warm amber LED */
	:global([data-theme="dark"]) .toggle-indicator {
		background: linear-gradient(
			90deg,
			rgba(255, 150, 50, 0.7) 0%,
			rgba(255, 200, 100, 0.9) 50%,
			rgba(255, 150, 50, 0.7) 100%
		);
		box-shadow:
			-1px 0 0 rgba(255, 100, 50, 0.6),
			1px 0 0 rgba(255, 200, 100, 0.6),
			0 0 8px rgba(255, 150, 80, 0.5),
			0 0 12px rgba(255, 150, 80, 0.3);
	}

	.theme-toggle:hover .toggle-indicator {
		filter: brightness(1.2);
		box-shadow:
			-2px 0 0 rgba(255, 50, 80, 0.6),
			2px 0 0 rgba(0, 255, 255, 0.6),
			0 0 12px rgba(255, 100, 200, 0.5),
			0 0 18px rgba(255, 100, 200, 0.3);
	}

	.theme-toggle:active {
		opacity: 0.9;
	}

	.toggle-inner {
		position: relative;
		width: 18px;
		height: 18px;
		display: flex;
		align-items: center;
		justify-content: center;
	}

	@media (min-width: 640px) {
		.toggle-inner {
			width: 20px;
			height: 20px;
		}
	}

	.toggle-icon {
		position: absolute;
		width: 100%;
		height: 100%;
		transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
		/* Light mode (dark bg): use light cream color */
		color: hsl(42deg 17% 80%);
		filter: invert(1);
	}

	:global([data-theme="dark"]) .toggle-icon {
		/* Dark mode (light bg): use dark slate color */
		color: hsl(247deg 8% 12%);
	}

	/* Moon icon - visible in light mode */
	.toggle-icon-moon {
		opacity: 1;
		transform: rotate(0deg) scale(1);
	}

	:global([data-theme="dark"]) .toggle-icon-moon {
		opacity: 0;
		transform: rotate(-90deg) scale(0.3);
		filter: none;
	}

	/* Sun icon - visible in dark mode */
	.toggle-icon-sun {
		opacity: 0;
		transform: rotate(90deg) scale(0.3);
	}

	:global([data-theme="dark"]) .toggle-icon-sun {
		opacity: 1;
		transform: rotate(0deg) scale(1);
	}

	/* Light bulb flicker animation on toggle */
	.theme-toggle.flickering .toggle-indicator {
		animation: led-flicker 0.5s ease-out forwards;
	}

	.theme-toggle.flickering .toggle-icon {
		animation: icon-flicker 0.5s ease-out forwards;
	}

	@keyframes led-flicker {
		0% {
			opacity: 0.2;
			filter: brightness(0.3);
			box-shadow: 0 0 2px rgba(0, 0, 0, 0.1);
		}
		8% {
			opacity: 1;
			filter: brightness(1.8);
			box-shadow:
				-3px 0 0 rgba(255, 50, 80, 0.9),
				3px 0 0 rgba(0, 255, 255, 0.9),
				0 0 20px rgba(255, 100, 200, 0.7),
				0 0 30px rgba(255, 100, 200, 0.4);
		}
		16% {
			opacity: 0.3;
			filter: brightness(0.4);
			box-shadow: 0 0 4px rgba(255, 100, 200, 0.2);
		}
		24% {
			opacity: 1;
			filter: brightness(1.5);
			box-shadow:
				-2px 0 0 rgba(255, 50, 80, 0.8),
				2px 0 0 rgba(0, 255, 255, 0.8),
				0 0 16px rgba(255, 100, 200, 0.6);
		}
		35% {
			opacity: 0.5;
			filter: brightness(0.7);
		}
		45% {
			opacity: 1;
			filter: brightness(1.4);
			box-shadow:
				-2px 0 0 rgba(255, 50, 80, 0.7),
				2px 0 0 rgba(0, 255, 255, 0.7),
				0 0 14px rgba(255, 100, 200, 0.5);
		}
		60% {
			opacity: 0.85;
			filter: brightness(1.1);
		}
		75% {
			opacity: 1;
			filter: brightness(1.2);
		}
		100% {
			opacity: 1;
			filter: brightness(1);
		}
	}

	@keyframes icon-flicker {
		0% {
			opacity: 0.2;
			filter: brightness(0.3);
		}
		8% {
			opacity: 1;
			filter: brightness(1.6) drop-shadow(0 0 4px currentColor);
		}
		16% {
			opacity: 0.3;
			filter: brightness(0.5);
		}
		24% {
			opacity: 1;
			filter: brightness(1.4) drop-shadow(0 0 3px currentColor);
		}
		35% {
			opacity: 0.6;
			filter: brightness(0.8);
		}
		45% {
			opacity: 1;
			filter: brightness(1.3);
		}
		60% {
			opacity: 0.9;
			filter: brightness(1.1);
		}
		100% {
			opacity: 1;
			filter: brightness(1);
		}
	}
</style>
