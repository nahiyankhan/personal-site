---
// Cursor Distortion Effect - Purple distortion bubble that follows the mouse
---

<div id="cursor-distortion" class="cursor-distortion"></div>

<script>
	function initCursorEffect() {
		const cursor = document.getElementById("cursor-distortion");

		if (!cursor) return;

		let mouseX = 0;
		let mouseY = 0;
		let currentX = 0;
		let currentY = 0;

		// Track mouse position
		document.addEventListener("mousemove", (e) => {
			mouseX = e.clientX;
			mouseY = e.clientY;
		});

		// Smooth animation loop
		function animate() {
			if (!cursor) return;

			// Smooth lerp (linear interpolation) for buttery movement
			currentX += (mouseX - currentX) * 0.15;
			currentY += (mouseY - currentY) * 0.15;

			// Update position via left/top instead of transform (to avoid CSS animation conflict)
			cursor.style.left = `${currentX - 90}px`; // Center the 180px circle
			cursor.style.top = `${currentY - 90}px`;

			requestAnimationFrame(animate);
		}

		animate();
	}

	// Initialize on load
	if (document.readyState === "loading") {
		document.addEventListener("DOMContentLoaded", initCursorEffect);
	} else {
		initCursorEffect();
	}

	// Also run on Astro page transitions
	document.addEventListener("astro:page-load", initCursorEffect);
</script>

<style>
	.cursor-distortion {
		position: fixed;
		top: 0;
		left: 0;
		width: 180px;
		height: 180px;
		border-radius: 50%;
		pointer-events: none;
		z-index: 99999;
		will-change: left, top;

		/* Subtle purple gradient with smooth fade */
		background: radial-gradient(
			circle,
			rgba(139, 92, 246, 0.12) 0%,
			rgba(139, 92, 246, 0.08) 25%,
			rgba(236, 72, 153, 0.05) 45%,
			rgba(236, 72, 153, 0.02) 65%,
			transparent 85%
		);

		/* Soft chromatic glow that fades smoothly */
		box-shadow:
			inset 0 0 40px rgba(139, 92, 246, 0.1),
			inset 0 0 60px rgba(236, 72, 153, 0.05),
			0 0 30px rgba(139, 92, 246, 0.08),
			0 0 50px rgba(236, 72, 153, 0.04);

		/* Glass distortion effect */
		backdrop-filter: blur(1.5px) saturate(1.2) hue-rotate(5deg);
		mix-blend-mode: soft-light;

		/* Subtle pulse animation */
		animation: cursor-pulse 4s ease-in-out infinite;
		opacity: 0.7;
	}

	@keyframes cursor-pulse {
		0%,
		100% {
			transform: scale(1);
			filter: blur(1.5px) saturate(1.2) hue-rotate(5deg);
		}
		50% {
			transform: scale(1.08);
			filter: blur(2px) saturate(1.3) hue-rotate(8deg);
		}
	}

	/* Hide on mobile/touch devices */
	@media (hover: none) and (pointer: coarse) {
		.cursor-distortion {
			display: none;
		}
	}
</style>
