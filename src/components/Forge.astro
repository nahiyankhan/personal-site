---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import Word from "./Word.astro";

// Query all non-draft forge items, sorted by date (newest first)
const forgeItems = await getCollection("forge", ({ data }) => !data.draft);
const sortedItems = forgeItems.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<div>
	<div class="relative flex flex-col items-start px-4 py-4 sm:px-8 sm:py-8">
		<div id="forge-logo" class="relative" data-logo-scale>
			<Word letters={["f", "o", "r", "g", "e"]} wordId="forge" />
		</div>
		<!-- <div class="relative inline-flex w-[fit-content]">
			<div class="baseline-on-grid text-sm">a.k.a tinker town where things break.</div>
		</div> -->
	</div>

	<div class="grid px-4 pb-16 sm:px-8 sm:pb-0">
		<!-- <Subtitle title="current-experiments" /> -->

		<div class="mb-4 grid grid-cols-1 gap-4 sm:mb-8 sm:grid-cols-4 sm:gap-8">
			{
				sortedItems.map((item) => (
					<div class="space-y-4">
						{item.data.coverImage && (
							<a
								href={`/forge/${item.slug}`}
								class="border-current/10 hover:border-current/30 block overflow-hidden rounded-lg border transition-all"
								transition:name={`${item.slug}-preview`}
							>
								<Image
									src={item.data.coverImage}
									alt={`${item.data.title} Preview`}
									class="h-auto w-full"
								/>
							</a>
						)}
						<div class="flex flex-col">
							<a
								href={`/forge/${item.slug}`}
								class="baseline-on-grid !mb-0 inline-block text-sm underline decoration-dotted underline-offset-4 hover:decoration-solid"
							>
								{item.data.title.toLowerCase()}
							</a>
							<p class="baseline-on-grid text-sm">{item.data.description.toLowerCase()}</p>
						</div>
					</div>
				))
			}
		</div>
	</div>
</div>

<script>
	import { initLetterSizing } from "@/utils/letterSizing";

	// FORGE = 5 letters
	initLetterSizing({ elementId: "forge-logo", letterCount: 5 });
</script>
