---
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";
import Subtitle from "./Subtitle.astro";
import Word from "./Word.astro";

// Type definitions for forge items
type ImagePreview = {
	type: "image";
	src: ImageMetadata;
	alt: string;
};

type VideoPreview = {
	type: "video";
	src: string;
	webm?: string;
};

type ForgeItem = {
	href: string;
	title: string;
	description: string;
	transitionName: string;
	preview: ImagePreview | VideoPreview;
};

// Define forge items - supports both image and video previews
const forgeItems: ForgeItem[] = [
	{
		href: "/prototypes/fluid-tile-grid",
		title: "fluid tile grid",
		description: "prototype of a fluid grid. react. framer motion.",
		transitionName: "fluid-tile-grid-preview",
		preview: {
			type: "video",
			src: "/videos/grid-loading.mp4",
		},
	},
	{
		href: "/prototypes/bitcoin-solari",
		title: "bitcoin solari",
		description: "visualization of Block's bitcoin treasury holdings. open source.",
		transitionName: "bitcoin-solari-preview",
		preview: {
			type: "video",
			src: "/videos/bitcoin-solari.mp4",
		},
	},
	{
		href: "/prototypes/music-viz",
		title: "music visualizer",
		description: "audio-reactive animations. from the portfolio editing floor.",
		transitionName: "music-viz-preview",
		preview: {
			type: "video",
			src: "/videos/music-viz.mp4",
		},
	},
	{
		href: "/prototypes/taste-explorer",
		title: "taste explorer",
		description: "an infinite random map of our collective taste.",
		transitionName: "taste-explorer-preview",
		preview: {
			type: "video",
			src: "/videos/taste-explorer-panning.mp4",
		},
	},
	{
		href: "/prototypes/brownian-motion",
		title: "chaos and order",
		description: "chaos and order experiments. react.",
		transitionName: "brownian-motion-preview",
		preview: {
			type: "video",
			src: "/videos/chaos-dots.mp4",
		},
	},
	{
		href: "/prototypes/tokens-viz",
		title: "tokens visualization",
		description: "interactive token visualization with multiple viewing modes and search.",
		transitionName: "tokens-viz-preview",
		preview: {
			type: "video",
			src: "/videos/tokens-cover.mp4",
		},
	},
];
---

<div>
	<div class="relative flex flex-col items-start px-4 py-4 sm:px-8 sm:pb-16 sm:pt-16">
		<div id="forge-logo" class="relative" data-logo-scale>
			<Word letters={["f", "o", "r", "g", "e"]} wordId="forge" />
		</div>
		<!-- <p class="mt-2 text-sm opacity-70">tinker town</p> -->
	</div>

	<div class="mt-4 grid px-4 pb-16 sm:px-8 sm:pb-32">
		<!-- Experiments Section -->
		<div class="mb-8 sm:mb-12">
			<Subtitle title="tinkers" />
			<div class="grid grid-cols-1 gap-4 sm:grid-cols-3 sm:gap-6 md:grid-cols-4">
				{
					forgeItems.map((item) => (
						<div class="space-y-2">
							<a
								href={item.href}
								class="forge-preview-link border-current/10 hover:border-current/30 block overflow-hidden rounded-lg border transition-all"
								transition:name={item.transitionName}
							>
								{item.preview.type === "image" ? (
									<Image
										src={(item.preview as ImagePreview).src}
										alt={(item.preview as ImagePreview).alt}
										class="h-auto w-full"
									/>
								) : (
									<video autoplay loop muted playsinline class="h-auto w-full">
										{(item.preview as VideoPreview).webm && (
											<source src={(item.preview as VideoPreview).webm} type="video/webm" />
										)}
										<source src={(item.preview as VideoPreview).src} type="video/mp4" />
									</video>
								)}
							</a>
							<div class="flex flex-col">
								<a
									href={item.href}
									class="baseline-on-grid !mb-0 inline-block text-sm underline decoration-dotted underline-offset-4 hover:decoration-solid"
								>
									{item.title}
								</a>
								<p class="baseline-on-grid text-sm">{item.description}</p>
							</div>
						</div>
					))
				}
			</div>
		</div>

		<!-- Cases Section -->
		<!-- <div>
			<Subtitle title="case-studies" />
			<div class="grid grid-cols-1 gap-4 sm:grid-cols-3 sm:gap-6 md:grid-cols-4">
				<div class="space-y-2">
					<a
						href="/cases/template"
						class="border-current/10 hover:border-current/30 aspect-[16/10] block overflow-hidden rounded-lg border transition-all"
					>
						<div
							class="bg-current/5 flex h-full w-full items-center justify-center text-xs opacity-30"
						>
							preview
						</div>
					</a>
					<div class="flex flex-col">
						<a
							href="/cases/template"
							class="baseline-on-grid !mb-0 inline-block text-sm underline decoration-dotted underline-offset-4 hover:decoration-solid"
						>
							case study template
						</a>
						<p class="baseline-on-grid text-sm">scroll-snap case study structure</p>
					</div>
				</div>
			</div>
		</div> -->
	</div>
</div>

<script>
	import { initLetterSizing } from "@/utils/letterSizing";

	// Use 7 letters to match NAHIYANKHAN sizing
	initLetterSizing({ elementId: "forge-logo", letterCount: 7 });
</script>
